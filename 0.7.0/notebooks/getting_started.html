
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Getting Started &#8212; Bambi 0.7.0 documentation</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/blank.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Examples" href="../examples.html" />
    <link rel="prev" title="BAyesian Model-Building Interface (Bambi) in Python" href="../index.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    
<a class="navbar-brand" href="../index.html">
<p class="title">Bambi</p>
</a>

    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 current active nav-item">
 <a class="current reference internal nav-link" href="#">
  Getting Started
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../examples.html">
  Examples
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../api_reference.html">
  API Reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../faq.html">
  Frequently Asked Questions
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/bambinos/bambi" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://pypi.org/project/bambi/" rel="noopener" target="_blank" title="PyPi">
            <span><i class="fas fa-box"></i></span>
            <label class="sr-only">PyPi</label>
          </a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>

  

  

<nav class="bd-links" id="bd-docs-nav" aria-label="Versions navigation">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
        <li class="toctree-l1 has-children">
            <p class="caption"><span class="caption-text">Version</span></p>
            <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox">
            <label for="toctree-checkbox-1"> <i class="fas fa-chevron-down"></i></label>

            <ul>
                  
                  <li><a href="../../main/index.html"> Development </a></li>
                  

                

                  
                    <li class="toctree-l2 current active"><a href="getting_started.html">0.7.0 (latest)</a></li>
                  

                

                

                  
                    <li><a href="../../0.6.3/index.html">0.6.3</a></li>
                  

                

                

                  
                    <li><a href="../../0.6.2/index.html">0.6.2</a></li>
                  

                

                

                  
                    <li><a href="../../0.6.1/index.html">0.6.1</a></li>
                  

                

                

                  
                    <li><a href="../../0.6.0/index.html">0.6.0</a></li>
                  

                

                

                  
                    <li><a href="../../0.5.0/index.html">0.5.0</a></li>
                  

                

                

                  
                    <li><a href="../../0.4.1/index.html">0.4.1</a></li>
                  

                

                

                  
                    <li><a href="../../0.4.0/index.html">0.4.0</a></li>
                  

                

                

                  
                    <li><a href="../../0.3.0/index.html">0.3.0</a></li>
                  

                

                

                  
                    <li><a href="../../0.2.0/index.html">0.2.0</a></li>
                  

                

                

                  
                    <li><a href="../../0.1.5/index.html">0.1.5</a></li>
                  

                

            </ul>
        </li>
        </ul>
    </div>
  </nav>


            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Quickstart">
   Quickstart
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#User-Guide">
   User Guide
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Setup">
     Setup
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Creating-a-model">
     Creating a model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Data-format">
     Data format
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Formula-based-specification">
   Formula-based specification
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Coding-of-categorical-variables">
     Coding of categorical variables
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Fitting-the-model">
     Fitting the model
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Specifying-priors">
   Specifying priors
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Generalized-linear-mixed-models">
   Generalized linear mixed models
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Families">
   Families
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Results">
   Results
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Plotting">
   Plotting
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Summarizing">
   Summarizing
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Accessing-back-end-objects">
   Accessing back-end objects
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="Getting-Started">
<h1>Getting Started<a class="headerlink" href="#Getting-Started" title="Permalink to this headline">¶</a></h1>
<p>Bambi requires a working Python interpreter (3.7+). We recommend installing Python and key numerical libraries using the <a class="reference external" href="https://www.anaconda.com/products/individual">Anaconda Distribution</a>, which has one-click installers available on all major platforms.</p>
<p>Assuming a standard Python environment is installed on your machine (including pip), Bambi itself can be installed in one line using pip:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>pip install bambi
</pre></div>
</div>
<p>Alternatively, if you want the bleeding edge version of the package, you can install from GitHub:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>pip install git+https://github.com/bambinos/bambi.git
</pre></div>
</div>
<section id="Quickstart">
<h2>Quickstart<a class="headerlink" href="#Quickstart" title="Permalink to this headline">¶</a></h2>
<p>Suppose we have data for a typical within-subjects psychology experiment with 2 experimental conditions. Stimuli are nested within condition, and subjects are crossed with condition. We want to fit a model predicting reaction time (RT) from the common effect of condition, group specific intercepts for subjects, group specific condition slopes for students, and group specific intercepts for stimuli. Using Bambi we can fit this model and summarize its results as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bambi</span> <span class="kn">import</span> <span class="n">Model</span>

<span class="c1"># Assume we already have our data loaded as a pandas DataFrame</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="s2">&quot;rt ~ condition + (condition|subject) + (1|stimulus)&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">draws</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">chains</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">az</span><span class="o">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="User-Guide">
<h2>User Guide<a class="headerlink" href="#User-Guide" title="Permalink to this headline">¶</a></h2>
<section id="Setup">
<h3>Setup<a class="headerlink" href="#Setup" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">arviz</span> <span class="k">as</span> <span class="nn">az</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">az</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;arviz-darkgrid&quot;</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">1234</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Generator(PCG64) at 0x7FA82A01D120
</pre></div></div>
</div>
</section>
<section id="Creating-a-model">
<h3>Creating a model<a class="headerlink" href="#Creating-a-model" title="Permalink to this headline">¶</a></h3>
<p>Creating a new model in Bambi is simple:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bambi</span> <span class="kn">import</span> <span class="n">Model</span>

<span class="c1"># Read in a tab-delimited file containing our data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="s2">&quot;data/my_data.txt&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Initialize the model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="s2">&quot;y ~ x + z&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

<span class="c1"># Inspect model object</span>
<span class="n">model</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Formula: y ~ x + z
Family name: Gaussian
Link: identity
Observations: 50
Priors:
  Common-level effects
    Intercept ~ Normal(mu: 0.1852, sigma: 2.5649)
    x ~ Normal(mu: 0.0, sigma: 2.231)
    z ~ Normal(mu: 0.0, sigma: 2.4374)

  Auxiliary parameters
    sigma ~ HalfStudentT(nu: 4, sigma: 1.013)

</pre></div></div>
</div>
<p>Typically, we will initialize a Bambi <code class="docutils literal notranslate"><span class="pre">Model</span></code> by passing it a model formula and a pandas <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. Other arguments such as family, priors, and link are available. By default, it uses <code class="docutils literal notranslate"><span class="pre">family=&quot;gaussian&quot;</span></code> which implies a linear regression with normal error. We get back a model that we can immediately fit by calling <code class="docutils literal notranslate"><span class="pre">model.fit()</span></code>.</p>
</section>
<section id="Data-format">
<h3>Data format<a class="headerlink" href="#Data-format" title="Permalink to this headline">¶</a></h3>
<p>As with most mixed effect modeling packages, Bambi expects data in “long” format–meaning that each row should reflects a single observation at the most fine-grained level of analysis. For example, given a model where students are nested into classrooms and classrooms are nested into schools, we would want data with the following kind of structure:</p>
<table class="table">
<colgroup>
<col style="width: 26%" />
<col style="width: 22%" />
<col style="width: 11%" />
<col style="width: 19%" />
<col style="width: 22%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>student</p></th>
<th class="head"><p>gender</p></th>
<th class="head"><p>gpa</p></th>
<th class="head"><p>class</p></th>
<th class="head"><p>school</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>F</p></td>
<td><p>3.4</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>F</p></td>
<td><p>3.7</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>M</p></td>
<td><p>2.2</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>F</p></td>
<td><p>3.9</p></td>
<td><p>2</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>M</p></td>
<td><p>3.6</p></td>
<td><p>2</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p>M</p></td>
<td><p>3.5</p></td>
<td><p>2</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>7</p></td>
<td><p>F</p></td>
<td><p>2.8</p></td>
<td><p>3</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p>8</p></td>
<td><p>M</p></td>
<td><p>3.9</p></td>
<td><p>3</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p>9</p></td>
<td><p>F</p></td>
<td><p>4.0</p></td>
<td><p>3</p></td>
<td><p>2</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="Formula-based-specification">
<h2>Formula-based specification<a class="headerlink" href="#Formula-based-specification" title="Permalink to this headline">¶</a></h2>
<p>Models are specified in Bambi using a formula-based syntax similar to what one might find in R packages like lme4 or brms using the Python <a class="reference external" href="https://github.com/bambinos/formulae">formulae</a> library. A couple of examples illustrate the breadth of models that can be easily specified in Bambi:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/rrr_long.csv&quot;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>uid</th>
      <th>condition</th>
      <th>gender</th>
      <th>age</th>
      <th>study</th>
      <th>self_perf</th>
      <th>stimulus</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>24.0</td>
      <td>0.0</td>
      <td>8.0</td>
      <td>rating_c1</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>27.0</td>
      <td>0.0</td>
      <td>9.0</td>
      <td>rating_c1</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>25.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>rating_c1</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>5.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>20.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>rating_c1</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>8.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>19.0</td>
      <td>0.0</td>
      <td>6.0</td>
      <td>rating_c1</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>9.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>22.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>rating_c1</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>10.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>49.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>rating_c1</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>11.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>24.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>rating_c1</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>12.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>26.0</td>
      <td>0.0</td>
      <td>6.0</td>
      <td>rating_c1</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>13.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>23.0</td>
      <td>0.0</td>
      <td>7.0</td>
      <td>rating_c1</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Number of rows with missing values</span>
<span class="n">data</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
401
</pre></div></div>
</div>
<p>We pass <code class="docutils literal notranslate"><span class="pre">dropna=True</span></code> to tell Bambi to drop rows containing missing values. The number of rows dropped is different from the numer of rows with missing values because Bambi only considers columns involved in the model.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Common (or fixed) effects only</span>
<span class="n">Model</span><span class="p">(</span><span class="s2">&quot;value ~ condition + age + gender&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Automatically removing 33/6940 rows from the dataset.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Formula: value ~ condition + age + gender
Family name: Gaussian
Link: identity
Observations: 6907
Priors:
  Common-level effects
    Intercept ~ Normal(mu: 4.5457, sigma: 28.4114)
    condition ~ Normal(mu: 0.0, sigma: 12.0966)
    age ~ Normal(mu: 0.0, sigma: 1.3011)
    gender ~ Normal(mu: 0.0, sigma: 13.1286)

  Auxiliary parameters
    sigma ~ HalfStudentT(nu: 4, sigma: 2.4186)

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Common effects and group specific (or random) intercepts for subject</span>
<span class="n">Model</span><span class="p">(</span><span class="s2">&quot;value ~ condition + age + gender + (1|uid)&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Automatically removing 33/6940 rows from the dataset.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Formula: value ~ condition + age + gender + (1|uid)
Family name: Gaussian
Link: identity
Observations: 6907
Priors:
  Common-level effects
    Intercept ~ Normal(mu: 4.5457, sigma: 28.4114)
    condition ~ Normal(mu: 0.0, sigma: 12.0966)
    age ~ Normal(mu: 0.0, sigma: 1.3011)
    gender ~ Normal(mu: 0.0, sigma: 13.1286)

  Group-level effects
    1|uid ~ Normal(mu: 0, sigma: HalfNormal(sigma: 28.4114))

  Auxiliary parameters
    sigma ~ HalfStudentT(nu: 4, sigma: 2.4186)

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Multiple, complex group specific effects with both</span>
<span class="c1"># group specific slopes and group specific intercepts</span>
<span class="n">Model</span><span class="p">(</span><span class="s2">&quot;value ~ condition + age + gender + (1|uid) + (condition|study) + (condition|stimulus)&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Automatically removing 33/6940 rows from the dataset.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Formula: value ~ condition + age + gender + (1|uid) + (condition|study) + (condition|stimulus)
Family name: Gaussian
Link: identity
Observations: 6907
Priors:
  Common-level effects
    Intercept ~ Normal(mu: 4.5457, sigma: 28.4114)
    condition ~ Normal(mu: 0.0, sigma: 12.0966)
    age ~ Normal(mu: 0.0, sigma: 1.3011)
    gender ~ Normal(mu: 0.0, sigma: 13.1286)

  Group-level effects
    1|uid ~ Normal(mu: 0, sigma: HalfNormal(sigma: 28.4114))
    1|study ~ Normal(mu: 0, sigma: HalfNormal(sigma: 28.4114))
    condition|study ~ Normal(mu: 0, sigma: HalfNormal(sigma: 12.0966))
    1|stimulus ~ Normal(mu: 0, sigma: HalfNormal(sigma: 28.4114))
    condition|stimulus ~ Normal(mu: 0, sigma: HalfNormal(sigma: 12.0966))

  Auxiliary parameters
    sigma ~ HalfStudentT(nu: 4, sigma: 2.4186)

</pre></div></div>
</div>
<p>Each of the above examples specifies a full model that can be fitted using PyMC3 by doing</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
<section id="Coding-of-categorical-variables">
<h3>Coding of categorical variables<a class="headerlink" href="#Coding-of-categorical-variables" title="Permalink to this headline">¶</a></h3>
<p>When a categorical common effect with N levels is added to a model, by default, it is coded by N-1 dummy variables (i.e., reduced-rank coding). For example, suppose we write <code class="docutils literal notranslate"><span class="pre">&quot;y</span> <span class="pre">~</span> <span class="pre">condition</span> <span class="pre">+</span> <span class="pre">age</span> <span class="pre">+</span> <span class="pre">gender&quot;</span></code>, where condition is a categorical variable with 4 levels, and age and gender are continuous variables. Then our model would contain an intercept term (added to the model by default, as in R), three dummy-coded variables (each contrasting the first level of <code class="docutils literal notranslate"><span class="pre">condition</span></code> with one of the
subsequent levels), and continuous predictors for age and gender. Suppose, however, that we would rather use full-rank coding of conditions. If we explicitly remove the intercept –as in <code class="docutils literal notranslate"><span class="pre">&quot;y</span> <span class="pre">~</span> <span class="pre">0</span> <span class="pre">+</span> <span class="pre">condition</span> <span class="pre">+</span> <span class="pre">age</span> <span class="pre">+</span> <span class="pre">gender&quot;</span></code>– then we get the desired effect. Now, the intercept is no longer included, and condition will be coded using 4 dummy indicators, each one coding for the presence or absence of the respective condition without reference to the other conditions.</p>
<p>Group specific effects are handled in a comparable way. When adding group specific intercepts, coding is always full-rank (e.g., when adding group specific intercepts for 100 schools, one gets 100 dummy-coded indicators coding each school separately, and not 99 indicators contrasting each school with the very first one). For group specific slopes, coding proceeds the same way as for common effects. The group specific effects specification <code class="docutils literal notranslate"><span class="pre">&quot;(condition|subject)&quot;</span></code> would add an intercept for each
subject, plus N-1 condition slopes (each coded with respect to the first, omitted, level as the referent). If we instead specify <code class="docutils literal notranslate"><span class="pre">(&quot;0+condition|subject)&quot;</span></code>, we get N condition slopes and no intercepts.</p>
</section>
<section id="Fitting-the-model">
<h3>Fitting the model<a class="headerlink" href="#Fitting-the-model" title="Permalink to this headline">¶</a></h3>
<p>Once a model is fully specified, we need to run the PyMC3 sampler to generate parameter estimates. If we’re using the one-line <code class="docutils literal notranslate"><span class="pre">fit()</span></code> interface, sampling will begin right away:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="s2">&quot;value ~ condition + age + gender + (1|uid)&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Automatically removing 33/6940 rows from the dataset.
Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (2 chains in 2 jobs)
NUTS: [value_sigma, 1|uid_offset, 1|uid_sigma, Intercept, gender, age, condition]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
    <style>
        /* Turns off some styling */
        progress {
            /* gets rid of default border in Firefox and Opera. */
            border: none;
            /* Needs to be in here for Safari polyfill so background images work as expected. */
            background-size: auto;
        }
        .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
            background: #F44336;
        }
    </style>
  <progress value='4000' class='' max='4000' style='width:300px; height:20px; vertical-align: middle;'></progress>
  100.00% [4000/4000 00:15<00:00 Sampling 2 chains, 0 divergences]
</div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Sampling 2 chains for 1_000 tune and 1_000 draw iterations (2_000 + 2_000 draws total) took 17 seconds.
</pre></div></div>
</div>
<p>The above code obtains 1,000 draws (the default value) and return them as an <code class="docutils literal notranslate"><span class="pre">InferenceData</span></code> instance (for more details, see the <a class="reference external" href="https://arviz-devs.github.io/arviz/schema/schema.html">ArviZ documentation</a>). In this case, the <code class="docutils literal notranslate"><span class="pre">fit()</span></code> method accepts optional keyword arguments to pass onto PyMC3’s <code class="docutils literal notranslate"><span class="pre">sample()</span></code> method, so any methods accepted by <code class="docutils literal notranslate"><span class="pre">sample()</span></code> can be specified here. We can also explicitly set the number of draws via the <code class="docutils literal notranslate"><span class="pre">draws</span></code> argument. For example, if we call
<code class="docutils literal notranslate"><span class="pre">fit(draws=2000,</span> <span class="pre">chains=2)</span></code>, the PyMC3 sampler will sample two chains in parallel, drawing 2,000 draws for each one. We could also specify starting parameter values, the step function to use, and so on (for full details, see the <a class="reference external" href="https://docs.pymc.io/api/inference.html#module-pymc3.sampling">PyMC3 documentation</a>).</p>
<p>Alternatively, we can build a model, but not fit it.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="s2">&quot;value ~ condition + age + gender + (1|uid)&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Automatically removing 33/6940 rows from the dataset.
</pre></div></div>
</div>
<p>Building without sampling can be useful if we want to inspect the internal PyMC3 model before we start the (potentially long) sampling process. Once we’re satisfied, and wish to run the sampler, we can then simply call <code class="docutils literal notranslate"><span class="pre">model.fit()</span></code>, and the sampler will start running. Another good reason to build a model is to generate plot of the marginal priors using <code class="docutils literal notranslate"><span class="pre">model.plot_priors()</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">plot_priors</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_getting_started_23_0.png" src="../_images/notebooks_getting_started_23_0.png" />
</div>
</div>
</section>
</section>
<section id="Specifying-priors">
<h2>Specifying priors<a class="headerlink" href="#Specifying-priors" title="Permalink to this headline">¶</a></h2>
<p>Bayesian inference requires one to specify prior probability distributions that represent the analyst’s belief (in advance of seeing the data) about the likely values of the model parameters. In practice, analysts often lack sufficient information to formulate well-defined priors, and instead opt to use “weakly informative” priors that mainly serve to keep the model from exploring completely pathological parts of the parameter space (e.g., when defining a prior on the distribution of human
heights, a value of 3,000 cms should be assigned a probability of exactly 0).</p>
<p>By default, Bambi will intelligently generate weakly informative priors for all model terms, by loosely scaling them to the observed data. Currently, Bambi uses a methodology very similar to the one described in the documentation of the R package <code class="docutils literal notranslate"><span class="pre">`rstanarm</span></code> &lt;<a class="reference external" href="https://mc-stan.org/rstanarm/articles/priors.html">https://mc-stan.org/rstanarm/articles/priors.html</a>&gt;`__. While the default priors will behave well in most typical settings, there are many cases where an analyst will want to specify their own priors–and in general, when informative priors
are available, it’s a good idea to use them.</p>
<!-- By default priors are specified on a (generalized) partial correlation scale that quantifies the expected standardized contribution of each individual term to the outcome variable when controlling for other terms. The default "wide" setting sets the scale of a common effect prior to $\sqrt{1/3} = 0.577$ on the partial correlation scale, which is the standard deviation of a flat prior from -1 to +1. This correlation-level scale value then gets translated to a Normal prior at the slope level, centered on 0 by default, with a correspondingly wide variance. This process results in a weakly informative (rather than non-informative) prior distribution whose width can be tuned in a simple, intuitive way. More detailed information about how the default priors work can be found in [this technical paper](https://arxiv.org/abs/1702.01201). --><p>You can pass <code class="docutils literal notranslate"><span class="pre">automatic_priors=&quot;mle&quot;</span></code> to the model initialization to recover the old default priors as described in <a class="reference external" href="https://arxiv.org/abs/1702.01201">this technical paper</a>. For example:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add condition to the model as a common effect with a super wide prior</span>
<span class="n">Model</span><span class="p">(</span><span class="s2">&quot;value ~ condition + gender + age + (condition|uid)&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">automatic_priors</span><span class="o">=</span><span class="s2">&quot;mle&quot;</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Automatically removing 33/6940 rows from the dataset.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Formula: value ~ condition + gender + age + (condition|uid)
Family name: Gaussian
Link: identity
Observations: 6907
Priors:
  Common-level effects
    Intercept ~ Normal(mu: 4.5457, sigma: 10.3262)
    condition ~ Normal(mu: 0, sigma: 4.3599)
    gender ~ Normal(mu: 0, sigma: 4.756)
    age ~ Normal(mu: 0, sigma: 0.4706)

  Group-level effects
    1|uid ~ Normal(mu: 0, sigma: HalfNormal(sigma: 5.9619))
    condition|uid ~ Normal(mu: 0, sigma: HalfNormal(sigma: 4.3599))

  Auxiliary parameters
    sigma ~ HalfStudentT(nu: 4, sigma: 2.4186)

</pre></div></div>
</div>
<p>These old default priors are specified on a (generalized) partial correlation scale that quantifies the expected standardized contribution of each individual term to the outcome variable when controlling for other terms. The default “wide” setting sets the scale of a common effect prior to <span class="math notranslate nohighlight">\(\sqrt{1/3} = 0.577\)</span> on the partial correlation scale, which is the standard deviation of a flat prior from -1 to +1. This correlation-level scale value then gets translated to a Normal prior at the
slope level, centered on 0 by default, with a correspondingly wide variance. This process results in a weakly informative (rather than non-informative) prior distribution whose width can be tuned in a simple, intuitive way.</p>
<p>Predefined named scales include “superwide” (scale = 0.8), “wide” (0.577; the default), “medium” (0.4), and “narrow” (0.2). The theoretical maximum scale value is 1.0, which specifies a distribution of partial correlations with half of the values at -1 and the other half at +1. Scale values closer to 0 are considered more “informative” and tend to induce more shrinkage in the parameter estimates.</p>
<p>In cases where we want to use the old default prior distributions, but alter their scale, we can specify either a numeric scale value or pass the name of a predefined constant. For example:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prior</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;condition&quot;</span><span class="p">:</span><span class="s2">&quot;superwide&quot;</span><span class="p">}</span>
<span class="n">Model</span><span class="p">(</span>
    <span class="s2">&quot;value ~ condition + gender + age + (condition|uid)&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
    <span class="n">priors</span><span class="o">=</span><span class="n">prior</span><span class="p">,</span> <span class="n">automatic_priors</span><span class="o">=</span><span class="s2">&quot;mle&quot;</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Automatically removing 33/6940 rows from the dataset.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Formula: value ~ condition + gender + age + (condition|uid)
Family name: Gaussian
Link: identity
Observations: 6907
Priors:
  Common-level effects
    Intercept ~ Normal(mu: 4.5457, sigma: 10.6932)
    condition ~ Normal(mu: 0, sigma: 7.1741)
    gender ~ Normal(mu: 0, sigma: 4.756)
    age ~ Normal(mu: 0, sigma: 0.4706)

  Group-level effects
    1|uid ~ Normal(mu: 0, sigma: HalfNormal(sigma: 6.1737))
    condition|uid ~ Normal(mu: 0, sigma: HalfNormal(sigma: 7.1741))

  Auxiliary parameters
    sigma ~ HalfStudentT(nu: 4, sigma: 2.4186)

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add group specific subject intercepts to the model, with a narrow prior on their standard deviation</span>
<span class="n">prior</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;condition|ui&quot;</span><span class="p">:</span><span class="s2">&quot;0.1&quot;</span><span class="p">}</span>
<span class="n">Model</span><span class="p">(</span>
    <span class="s2">&quot;value ~ condition + gender + age + (condition|uid)&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
    <span class="n">priors</span><span class="o">=</span><span class="n">prior</span><span class="p">,</span> <span class="n">automatic_priors</span><span class="o">=</span><span class="s2">&quot;mle&quot;</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Automatically removing 33/6940 rows from the dataset.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Formula: value ~ condition + gender + age + (condition|uid)
Family name: Gaussian
Link: identity
Observations: 6907
Priors:
  Common-level effects
    Intercept ~ Normal(mu: 4.5457, sigma: 10.3262)
    condition ~ Normal(mu: 0, sigma: 4.3599)
    gender ~ Normal(mu: 0, sigma: 4.756)
    age ~ Normal(mu: 0, sigma: 0.4706)

  Group-level effects
    1|uid ~ Normal(mu: 0, sigma: HalfNormal(sigma: 5.9619))
    condition|uid ~ Normal(mu: 0, sigma: HalfNormal(sigma: 4.3599))

  Auxiliary parameters
    sigma ~ HalfStudentT(nu: 4, sigma: 2.4186)

</pre></div></div>
</div>
<p>The ability to specify prior scales this way is helpful, but also limited: we will sometimes find ourselves wanting to use something other than a Normal distribution to model our priors. Fortunately, Bambi is built on top of PyMC3, which means that we can seamlessly use any of the over 40 <code class="docutils literal notranslate"><span class="pre">Distribution</span></code> classes defined in PyMC3. We can specify such priors in Bambi using the <code class="docutils literal notranslate"><span class="pre">Prior</span></code> class, which initializes with a <code class="docutils literal notranslate"><span class="pre">name</span></code> argument (which must map on exactly to the name of a valid PyMC3
<code class="docutils literal notranslate"><span class="pre">Distribution</span></code>) followed by any of the parameters accepted by the corresponding <code class="docutils literal notranslate"><span class="pre">distribution</span></code>. For example:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bambi</span> <span class="kn">import</span> <span class="n">Prior</span>

<span class="c1"># A Laplace prior with mean of 0 and scale of 10</span>
<span class="n">my_favorite_prior</span> <span class="o">=</span> <span class="n">Prior</span><span class="p">(</span><span class="s2">&quot;Laplace&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Set the prior when adding a term to the model; more details on this below.</span>
<span class="n">priors</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;1|uid&quot;</span><span class="p">:</span> <span class="n">my_favorite_prior</span><span class="p">}</span>
<span class="n">Model</span><span class="p">(</span><span class="s2">&quot;value ~ condition + (1|uid)&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">priors</span><span class="o">=</span><span class="n">priors</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Automatically removing 9/6940 rows from the dataset.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Formula: value ~ condition + (1|uid)
Family name: Gaussian
Link: identity
Observations: 6931
Priors:
  Common-level effects
    Intercept ~ Normal(mu: 4.5516, sigma: 8.4548)
    condition ~ Normal(mu: 0.0, sigma: 12.1019)

  Group-level effects
    1|uid ~ Laplace(mu: 0, b: 10)

  Auxiliary parameters
    sigma ~ HalfStudentT(nu: 4, sigma: 2.4197)

</pre></div></div>
</div>
<p>Priors specified using the <code class="docutils literal notranslate"><span class="pre">Prior</span></code> class can be nested to arbitrary depths–meaning, we can set any of a given prior’s argument to point to another <code class="docutils literal notranslate"><span class="pre">Prior</span></code> instance. This is particularly useful when specifying hierarchical priors on group specific effects, where the individual group specific slopes or intercepts are constrained to share a common source distribution:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">subject_sd</span> <span class="o">=</span> <span class="n">Prior</span><span class="p">(</span><span class="s2">&quot;HalfCauchy&quot;</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">subject_prior</span> <span class="o">=</span> <span class="n">Prior</span><span class="p">(</span><span class="s2">&quot;Normal&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="n">subject_sd</span><span class="p">)</span>
<span class="n">priors</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;1|uid&quot;</span><span class="p">:</span> <span class="n">subject_prior</span><span class="p">}</span>
<span class="n">Model</span><span class="p">(</span><span class="s2">&quot;value ~ condition + (1|uid)&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">priors</span><span class="o">=</span><span class="n">priors</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Automatically removing 9/6940 rows from the dataset.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Formula: value ~ condition + (1|uid)
Family name: Gaussian
Link: identity
Observations: 6931
Priors:
  Common-level effects
    Intercept ~ Normal(mu: 4.5516, sigma: 8.4548)
    condition ~ Normal(mu: 0.0, sigma: 12.1019)

  Group-level effects
    1|uid ~ Normal(mu: 0, sd: HalfCauchy(beta: 5))

  Auxiliary parameters
    sigma ~ HalfStudentT(nu: 4, sigma: 2.4197)

</pre></div></div>
</div>
<p>The above prior specification indicates that the individual subject intercepts are to be treated as if they are randomly sampled from the same underlying normal distribution, where the variance of that normal distribution is parameterized by a separate hyperprior (a half-cauchy with beta = 5).</p>
<p><strong>Note:</strong> The following describes the behavior of the <strong>old</strong> default priors that are going to be deprecated. This section is going to be removed in the future together with old default priors.</p>
<p>Once we’ve defined custom priors for one or more terms, we need to map them onto those terms in our model. Bambi allows us to do this efficiently by passing a dictionary of term -&gt; prior mappings in a <code class="docutils literal notranslate"><span class="pre">fit()</span></code> call (and also via a separate <code class="docutils literal notranslate"><span class="pre">set_priors()</span></code> method on the <code class="docutils literal notranslate"><span class="pre">Model</span></code> class). The keys of the dictionary the names of terms, and the values are the desired priors. There are also <code class="docutils literal notranslate"><span class="pre">common</span></code> and <code class="docutils literal notranslate"><span class="pre">group_specific</span></code> arguments that make it easy to apply the same priors to all common or group
specific effects in the model. Some examples:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s2">&quot;y&quot;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">50</span><span class="p">),</span>
    <span class="s2">&quot;X1&quot;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">50</span><span class="p">),</span>
    <span class="s2">&quot;X2&quot;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">50</span><span class="p">),</span>
    <span class="s2">&quot;X3&quot;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">50</span><span class="p">),</span>
    <span class="s2">&quot;X4&quot;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example 1: set each prior by name. Note that we can set the same</span>
<span class="c1"># prior for multiple terms at once, by passing a tuple in the key.</span>
<span class="n">priors</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;X1&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>
    <span class="s2">&quot;X2&quot;</span><span class="p">:</span> <span class="s2">&quot;medium&quot;</span><span class="p">,</span>
    <span class="p">(</span><span class="s2">&quot;X3&quot;</span><span class="p">,</span> <span class="s2">&quot;X4&quot;</span><span class="p">):</span> <span class="n">Prior</span><span class="p">(</span><span class="s2">&quot;ZeroInflatedPoisson&quot;</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">psi</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span>
<span class="p">}</span>
<span class="n">Model</span><span class="p">(</span><span class="s2">&quot;y ~ X1 + X2 + (1|X3) + (1|X4)&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">priors</span><span class="o">=</span><span class="n">priors</span><span class="p">,</span> <span class="n">automatic_priors</span><span class="o">=</span><span class="s2">&quot;mle&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Formula: y ~ X1 + X2 + (1|X3) + (1|X4)
Family name: Gaussian
Link: identity
Observations: 50
Priors:
  Common-level effects
    Intercept ~ Normal(mu: 0.0322, sigma: 0.8434)
    X1 ~ Normal(mu: 0, sigma: 0.3487)
    X2 ~ Normal(mu: 0, sigma: 0.4543)

  Group-level effects
    1|X3 ~ Normal(mu: 0, sigma: HalfNormal(sigma: 0.4869))
    1|X4 ~ Normal(mu: 0, sigma: HalfNormal(sigma: 0.4869))

  Auxiliary parameters
    sigma ~ HalfStudentT(nu: 4, sigma: 0.8346)

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example 2: specify priors for all common effects and all group specific</span>
<span class="c1"># effects, except for X1, which still gets its own custom prior.</span>
<span class="n">priors</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;X1&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span> <span class="s2">&quot;common&quot;</span><span class="p">:</span> <span class="n">Prior</span><span class="p">(</span><span class="s2">&quot;Normal&quot;</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="mi">100</span><span class="p">),</span> <span class="s2">&quot;group_specific&quot;</span><span class="p">:</span> <span class="s2">&quot;wide&quot;</span><span class="p">}</span>
<span class="n">Model</span><span class="p">(</span><span class="s2">&quot;y ~ X1 + X2 + (1|X3) + (1|X4)&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">priors</span><span class="o">=</span><span class="n">priors</span><span class="p">,</span> <span class="n">automatic_priors</span><span class="o">=</span><span class="s2">&quot;mle&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Formula: y ~ X1 + X2 + (1|X3) + (1|X4)
Family name: Gaussian
Link: identity
Observations: 50
Priors:
  Common-level effects
    Intercept ~ Normal(sd: 100)
    X1 ~ Normal(mu: 0, sigma: 0.3487)
    X2 ~ Normal(sd: 100)

  Group-level effects
    1|X3 ~ Normal(mu: 0, sigma: HalfNormal(sigma: 0.4869))
    1|X4 ~ Normal(mu: 0, sigma: HalfNormal(sigma: 0.4869))

  Auxiliary parameters
    sigma ~ HalfStudentT(nu: 4, sigma: 0.8346)

</pre></div></div>
</div>
<p>Notice how this interface allows us to specify terms either by name (including passing tuples as keys in cases where we want multiple terms to share the same prior), or by term type (i.e., to set the same prior on all common or group specific effects). If we pass both named priors and common or group specific effects defaults, the former will take precedence over the latter (in the above example, the prior for <code class="docutils literal notranslate"><span class="pre">'X1'</span></code> will be <code class="docutils literal notranslate"><span class="pre">0.3</span></code>).</p>
<p>If we prefer, we can also set priors outside of the model instantiation , using the <code class="docutils literal notranslate"><span class="pre">set_priors()</span></code> method:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Specify model but don&#39;t build/sample just yet</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="s2">&quot;y ~ X1 + X2 + (1|X3) + (1|X4)&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">automatic_priors</span><span class="o">=</span><span class="s2">&quot;mle&quot;</span><span class="p">)</span>

<span class="c1"># Specify priors—produces same result as in Example 2 above</span>
<span class="n">model</span><span class="o">.</span><span class="n">set_priors</span><span class="p">({</span><span class="s2">&quot;X1&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">},</span> <span class="n">common</span><span class="o">=</span><span class="n">Prior</span><span class="p">(</span><span class="s2">&quot;Normal&quot;</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="mi">100</span><span class="p">),</span> <span class="n">group_specific</span><span class="o">=</span><span class="s2">&quot;wide&quot;</span><span class="p">)</span>

<span class="n">model</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Formula: y ~ X1 + X2 + (1|X3) + (1|X4)
Family name: Gaussian
Link: identity
Observations: 50
Priors:
  Common-level effects
    Intercept ~ Normal(mu: 0.0322, sigma: 0.8449)
    X1 ~ Normal(mu: 0, sigma: 0.3487)
    X2 ~ Normal(sd: 100)

  Group-level effects
    1|X3 ~ Normal(mu: 0, sigma: HalfNormal(sigma: 0.4869))
    1|X4 ~ Normal(mu: 0, sigma: HalfNormal(sigma: 0.4869))

  Auxiliary parameters
    sigma ~ HalfStudentT(nu: 4, sigma: 0.8346)

</pre></div></div>
</div>
<p>It’s important to note that explicitly setting priors by passing in <code class="docutils literal notranslate"><span class="pre">Prior</span></code> objects will disable Bambi’s default behavior of scaling priors to the data in order to ensure that they remain weakly informative. This means that if you specify your own prior, you have to be sure not only to specify the distribution you want, but also any relevant scale parameters. For example, the 0.5 in <code class="docutils literal notranslate"><span class="pre">Prior(&quot;Normal&quot;,</span> <span class="pre">mu=0,</span> <span class="pre">sd=0.5)</span></code> will be specified on the scale of the data, not the bounded partial
correlation scale that Bambi uses for default priors. This means that if your outcome variable has a mean value of 10,000 and a standard deviation of, say, 1,000, you could potentially have some problems getting the model to produce reasonable estimates, since from the perspective of the data, you’re specifying an extremely strong prior.</p>
</section>
<section id="Generalized-linear-mixed-models">
<h2>Generalized linear mixed models<a class="headerlink" href="#Generalized-linear-mixed-models" title="Permalink to this headline">¶</a></h2>
<p>Bambi supports the construction of mixed models with non-normal response distributions (i.e., generalized linear mixed models, or GLMMs). GLMMs are specified in the same way as LMMs, except that the user must specify the distribution to use for the response, and (optionally) the link function with which to transform the linear model prediction into the desired non-normal response. The easiest way to construct a GLMM is to simple set the <code class="docutils literal notranslate"><span class="pre">family</span></code> when creating the model:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;http://www.karlin.mff.cuni.cz/~pesta/prednasky/NMFM404/Data/binary.csv&quot;</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="s2">&quot;admit ~ gre + gpa + rank&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="s2">&quot;bernoulli&quot;</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Modeling the probability that admit==1
Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (2 chains in 2 jobs)
NUTS: [Intercept, rank, gpa, gre]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
    <style>
        /* Turns off some styling */
        progress {
            /* gets rid of default border in Firefox and Opera. */
            border: none;
            /* Needs to be in here for Safari polyfill so background images work as expected. */
            background-size: auto;
        }
        .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
            background: #F44336;
        }
    </style>
  <progress value='4000' class='' max='4000' style='width:300px; height:20px; vertical-align: middle;'></progress>
  100.00% [4000/4000 00:04<00:00 Sampling 2 chains, 0 divergences]
</div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Sampling 2 chains for 1_000 tune and 1_000 draw iterations (2_000 + 2_000 draws total) took 5 seconds.
</pre></div></div>
</div>
<p>If no <code class="docutils literal notranslate"><span class="pre">link</span></code> argument is explicitly set (see below), the canonical link function (or an otherwise sensible default) will be used. The following table summarizes the currently available families and their associated links:</p>
<center><table class="table">
<colgroup>
<col style="width: 31%" />
<col style="width: 40%" />
<col style="width: 29%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Family name</p></th>
<th class="head"><p>Response distribution</p></th>
<th class="head"><p>Default link</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>bernoulli</p></td>
<td><p>Bernoulli</p></td>
<td><p>logit</p></td>
</tr>
<tr class="row-odd"><td><p>beta</p></td>
<td><p>Beta</p></td>
<td><p>logit</p></td>
</tr>
<tr class="row-even"><td><p>binomial</p></td>
<td><p>Binomial</p></td>
<td><p>logit</p></td>
</tr>
<tr class="row-odd"><td><p>gamma</p></td>
<td><p>Gamma</p></td>
<td><p>inverse</p></td>
</tr>
<tr class="row-even"><td><p>gaussian</p></td>
<td><p>Normal</p></td>
<td><p>identity</p></td>
</tr>
<tr class="row-odd"><td><p>negativebinomial</p></td>
<td><p>NegativeBinomial</p></td>
<td><p>log</p></td>
</tr>
<tr class="row-even"><td><p>poisson</p></td>
<td><p>Poisson</p></td>
<td><p>log</p></td>
</tr>
<tr class="row-odd"><td><p>t</p></td>
<td><p>StudentT</p></td>
<td><p>identity</p></td>
</tr>
<tr class="row-even"><td><p>wald</p></td>
<td><p>InverseGaussian</p></td>
<td><p>inverse squared</p></td>
</tr>
</tbody>
</table>
</center></section>
<section id="Families">
<h2>Families<a class="headerlink" href="#Families" title="Permalink to this headline">¶</a></h2>
<p>Following the convention used in many R packages, the response distribution to use for a GLMM is specified in a <code class="docutils literal notranslate"><span class="pre">Family</span></code> class that indicates how the response variable is distributed, as well as the link function transforming the linear response to a non-linear one. Although the easiest way to specify a family is by name, using one of the options listed in the table above, users can also create and use their own family, providing enormous flexibility. In the following example, we show how the
built-in Bernoulli family could be constructed on-the-fly:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">theano.tensor</span> <span class="k">as</span> <span class="nn">tt</span>

<span class="kn">from</span> <span class="nn">bambi</span> <span class="kn">import</span> <span class="n">Family</span><span class="p">,</span> <span class="n">Likelihood</span><span class="p">,</span> <span class="n">Link</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">special</span>

<span class="c1"># Construct likelihood distribution ------------------------------</span>
<span class="c1"># This must use a valid PyMC3 distribution name.</span>
<span class="c1"># &#39;parent&#39; is the name of the variable that represents the mean of the distribution.</span>
<span class="c1"># The mean of the Bernoulli family is given by &#39;p&#39;.</span>
<span class="n">likelihood</span> <span class="o">=</span> <span class="n">Likelihood</span><span class="p">(</span><span class="s2">&quot;Bernoulli&quot;</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="s2">&quot;p&quot;</span><span class="p">)</span>

<span class="c1"># Set link function ----------------------------------------------</span>
<span class="c1"># There are two alternative approaches.</span>
<span class="c1"># 1. Pass a name that is known by Bambi</span>
<span class="n">link</span> <span class="o">=</span> <span class="n">Link</span><span class="p">(</span><span class="s2">&quot;logit&quot;</span><span class="p">)</span>

<span class="c1"># 2. Build everything from scratch</span>
<span class="c1"># link: A function that maps the response to the linear predictor</span>
<span class="c1"># linkinv: A function that maps the linear predictor to the response</span>
<span class="c1"># linkinv_backend: A function that maps the linear predictor to the response</span>
<span class="c1">#                  that works with Theano tensors</span>
<span class="n">link</span> <span class="o">=</span> <span class="n">Link</span><span class="p">(</span>
    <span class="s2">&quot;my_logit&quot;</span><span class="p">,</span>
    <span class="n">link</span><span class="o">=</span><span class="n">special</span><span class="o">.</span><span class="n">expit</span><span class="p">,</span>
    <span class="n">linkinv</span><span class="o">=</span><span class="n">special</span><span class="o">.</span><span class="n">logit</span><span class="p">,</span>
    <span class="n">linkinv_backend</span><span class="o">=</span><span class="n">tt</span><span class="o">.</span><span class="n">nnet</span><span class="o">.</span><span class="n">sigmoid</span>
<span class="p">)</span>

<span class="c1"># Construct the family -------------------------------------------</span>
<span class="c1"># Families are defined by a name, a Likelihood and a Link.</span>
<span class="n">family</span> <span class="o">=</span> <span class="n">Family</span><span class="p">(</span><span class="s2">&quot;bernoulli&quot;</span><span class="p">,</span> <span class="n">likelihood</span><span class="p">,</span> <span class="n">link</span><span class="p">)</span>

<span class="c1"># Now it&#39;s business as usual</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="s2">&quot;admit ~ gre + gpa + rank&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="n">family</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Modeling the probability that admit==1
Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (2 chains in 2 jobs)
NUTS: [Intercept, rank, gpa, gre]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
    <style>
        /* Turns off some styling */
        progress {
            /* gets rid of default border in Firefox and Opera. */
            border: none;
            /* Needs to be in here for Safari polyfill so background images work as expected. */
            background-size: auto;
        }
        .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
            background: #F44336;
        }
    </style>
  <progress value='4000' class='' max='4000' style='width:300px; height:20px; vertical-align: middle;'></progress>
  100.00% [4000/4000 00:04<00:00 Sampling 2 chains, 0 divergences]
</div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Sampling 2 chains for 1_000 tune and 1_000 draw iterations (2_000 + 2_000 draws total) took 5 seconds.
</pre></div></div>
</div>
<p>The above example produces results identical to simply setting <code class="docutils literal notranslate"><span class="pre">family='bernoulli'</span></code>.</p>
<p>One complication in specifying a custom <code class="docutils literal notranslate"><span class="pre">Family</span></code> is that you have to pass the link the inverse link functions, together with an inverse llink function that must be able to operate over theano tensors rather than numpy arrays, so you’ll probably need to rely on tensor operations provided in <code class="docutils literal notranslate"><span class="pre">theano.tensor</span></code> (many of which are also wrapped by PyMC3) when defining a new link.</p>
</section>
<section id="Results">
<h2>Results<a class="headerlink" href="#Results" title="Permalink to this headline">¶</a></h2>
<p>When a model is fitted, it returns a <code class="docutils literal notranslate"><span class="pre">InferenceData</span></code> object containing data related to the model and the posterior. This object can be passed to many functions in ArviZ to obtain numerical and visuals diagnostics and plot in general.</p>
</section>
<section id="Plotting">
<h2>Plotting<a class="headerlink" href="#Plotting" title="Permalink to this headline">¶</a></h2>
<p>To visualize a plot of the posterior estimates and sample traces for all parameters, simply pass the <code class="docutils literal notranslate"><span class="pre">InferenceData</span></code> object to the arviz function <code class="docutils literal notranslate"><span class="pre">az._plot_trace</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">az</span><span class="o">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">compact</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_getting_started_47_0.png" src="../_images/notebooks_getting_started_47_0.png" />
</div>
</div>
<p>More details on this plot are available in the <a class="reference external" href="https://arviz-devs.github.io/arviz/_modules/arviz/plots/traceplot.html">ArviZ documentation</a>.</p>
</section>
<section id="Summarizing">
<h2>Summarizing<a class="headerlink" href="#Summarizing" title="Permalink to this headline">¶</a></h2>
<p>If you prefer numerical summaries of the posterior estimates, you can use the <code class="docutils literal notranslate"><span class="pre">az.summary()</span></code> function from <a class="reference external" href="https://arviz-devs.github.io/arviz/generated/arviz.summary.html#arviz.summary">ArviZ</a> which provides a pandas DataFrame with some key summary and diagnostics info on the model parameters, such as the 94% highest posterior density intervals:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>sd</th>
      <th>hdi_3%</th>
      <th>hdi_97%</th>
      <th>mcse_mean</th>
      <th>mcse_sd</th>
      <th>ess_bulk</th>
      <th>ess_tail</th>
      <th>r_hat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Intercept</th>
      <td>-3.508</td>
      <td>1.137</td>
      <td>-5.570</td>
      <td>-1.369</td>
      <td>0.020</td>
      <td>0.015</td>
      <td>3124.0</td>
      <td>1636.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>gre</th>
      <td>0.002</td>
      <td>0.001</td>
      <td>0.000</td>
      <td>0.004</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>2340.0</td>
      <td>1549.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>gpa</th>
      <td>0.790</td>
      <td>0.337</td>
      <td>0.121</td>
      <td>1.374</td>
      <td>0.007</td>
      <td>0.005</td>
      <td>2410.0</td>
      <td>1624.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>rank</th>
      <td>-0.567</td>
      <td>0.131</td>
      <td>-0.801</td>
      <td>-0.311</td>
      <td>0.002</td>
      <td>0.002</td>
      <td>2764.0</td>
      <td>1410.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>If you want to view summaries or plots for specific parameters, you can pass a list of its names:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># show the names of all variables stored in the InferenceData object</span>
<span class="nb">list</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">posterior</span><span class="o">.</span><span class="n">data_vars</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;Intercept&#39;, &#39;gre&#39;, &#39;gpa&#39;, &#39;rank&#39;]
</pre></div></div>
</div>
<p>You can find detailed, worked examples of fitting Bambi models and working with the results in the example notebooks <a class="reference external" href="bambi/examples.html">here</a>.</p>
</section>
<section id="Accessing-back-end-objects">
<h2>Accessing back-end objects<a class="headerlink" href="#Accessing-back-end-objects" title="Permalink to this headline">¶</a></h2>
<p>Bambi is just a high-level interface to PyMC3; as such. Internally, Bambi stores virtually all objects generated by PyMC3, making it easy for users to retrieve, inspect, and modify those objects. For example, the <code class="docutils literal notranslate"><span class="pre">Model</span></code> class created by PyMC3 (as opposed to the Bambi class of the same name) is accessible from <code class="docutils literal notranslate"><span class="pre">model.backend.model</span></code>.</p>
</section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="../index.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">BAyesian Model-Building Interface (Bambi) in Python</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../examples.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Examples</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2021, The developers of Bambi.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.3.2.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>