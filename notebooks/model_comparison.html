
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Logistic Regression and Model Comparison with Bambi and Arviz &#8212; bambi 0.3.0 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API Reference" href="../api_reference.html" />
    <link rel="prev" title="Bayesian Workflow (Strack RRR Analysis Replication)" href="Strack_RRR_re_analysis.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    min-width: 5.5ex;
    padding-top: 0.3rem;
    padding-right: 0.3rem;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 0.3rem;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Logistic-Regression-and-Model-Comparison-with-Bambi-and-Arviz">
<h1>Logistic Regression and Model Comparison with Bambi and Arviz<a class="headerlink" href="#Logistic-Regression-and-Model-Comparison-with-Bambi-and-Arviz" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Adults-dataset">
<h2>Adults dataset<a class="headerlink" href="#Adults-dataset" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">The <a class="reference external" href="http://archive.ics.uci.edu/ml/datasets/Adult">adults dataset</a> is comprised of census data from 1994 in United States.</div>
<div class="line">The goal is to use demographic variables to predict whether an individual makes more than $50,000 per year.</div>
</div>
<p>The following is a description of the variables in the dataset.</p>
<ul class="simple">
<li><p><strong>age</strong>: Individual’s age</p></li>
<li><p><strong>workclass</strong>: Labor class.</p></li>
<li><p><strong>fnlwgt</strong>: It is not specified, but we guess it is a final sampling weight.</p></li>
<li><p><strong>education</strong>: Education level as a categorical variable.</p></li>
<li><p><strong>educational_num</strong>: Education level as numerical variable. It does not reflect years of education.</p></li>
<li><p><strong>marital_status</strong>: Marital status.</p></li>
<li><p><strong>occupation</strong>: Occupation.</p></li>
<li><p><strong>relationship</strong>: Relationship with the head of household.</p></li>
<li><p><strong>race</strong>: Individual’s race.</p></li>
<li><p><strong>sex</strong>: Individual’s sex.</p></li>
<li><p><strong>capital_gain</strong>: Capital gain during unspecified period of time.</p></li>
<li><p><strong>capital_loss</strong>: Capital loss during unspecified period of time.</p></li>
<li><p><strong>hs_week</strong>: Hours of work per week.</p></li>
<li><p><strong>native_country</strong>: Country of birth.</p></li>
<li><p><strong>income</strong>: Income as a binary variable (either below or above 50K per year).</p></li>
</ul>
<p>We are only using the following variables in this example: <strong>income</strong>, <strong>sex</strong>, <strong>race</strong>, <strong>age</strong>, and <strong>hs_week</strong>. This subset is comprised of both categorical and numerical variables which allows us to visualize how to incorporate both types in a logistic regression model while helping to keep the analysis simpler.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">arviz</span> <span class="k">as</span> <span class="nn">az</span>
<span class="kn">import</span> <span class="nn">bambi</span> <span class="k">as</span> <span class="nn">bmb</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.lines</span> <span class="k">as</span> <span class="nn">mlines</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">expit</span> <span class="k">as</span> <span class="n">invlogit</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Disable a FutureWarning in ArviZ at the moment of running the notebook</span>
<span class="n">az</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;arviz-darkgrid&quot;</span><span class="p">)</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="s2">&quot;data/adult.data&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">skipinitialspace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                     <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;workclass&#39;</span><span class="p">,</span> <span class="s1">&#39;fnlwgt&#39;</span><span class="p">,</span> <span class="s1">&#39;education&#39;</span><span class="p">,</span> <span class="s1">&#39;education_num&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;marital_status&#39;</span><span class="p">,</span> <span class="s1">&#39;occupation&#39;</span><span class="p">,</span> <span class="s1">&#39;relationship&#39;</span><span class="p">,</span> <span class="s1">&#39;race&#39;</span><span class="p">,</span> <span class="s1">&#39;sex&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;captial_gain&#39;</span><span class="p">,</span> <span class="s1">&#39;capital_loss&#39;</span><span class="p">,</span> <span class="s1">&#39;hs_week&#39;</span><span class="p">,</span> <span class="s1">&#39;native_country&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;income&#39;</span><span class="p">])</span>
<span class="c1"># Select only columns we&#39;re going to use</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s2">&quot;income&quot;</span><span class="p">,</span> <span class="s2">&quot;sex&quot;</span><span class="p">,</span> <span class="s2">&quot;race&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="s2">&quot;hs_week&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 32561 entries, 0 to 32560
Data columns (total 5 columns):
 #   Column   Non-Null Count  Dtype
---  ------   --------------  -----
 0   income   32561 non-null  object
 1   sex      32561 non-null  object
 2   race     32561 non-null  object
 3   age      32561 non-null  int64
 4   hs_week  32561 non-null  int64
dtypes: int64(2), object(3)
memory usage: 1.2+ MB
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>income</th>
      <th>sex</th>
      <th>race</th>
      <th>age</th>
      <th>hs_week</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>&lt;=50K</td>
      <td>Male</td>
      <td>White</td>
      <td>39</td>
      <td>40</td>
    </tr>
    <tr>
      <th>1</th>
      <td>&lt;=50K</td>
      <td>Male</td>
      <td>White</td>
      <td>50</td>
      <td>13</td>
    </tr>
    <tr>
      <th>2</th>
      <td>&lt;=50K</td>
      <td>Male</td>
      <td>White</td>
      <td>38</td>
      <td>40</td>
    </tr>
    <tr>
      <th>3</th>
      <td>&lt;=50K</td>
      <td>Male</td>
      <td>Black</td>
      <td>53</td>
      <td>40</td>
    </tr>
    <tr>
      <th>4</th>
      <td>&lt;=50K</td>
      <td>Female</td>
      <td>Black</td>
      <td>28</td>
      <td>40</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Categorical variables are presented as from type <code class="docutils literal notranslate"><span class="pre">object</span></code>. In this step we convert them to <code class="docutils literal notranslate"><span class="pre">category</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">categorical_cols</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">dtypes</span> <span class="o">==</span> <span class="nb">object</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">categorical_cols</span><span class="p">:</span>
    <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 32561 entries, 0 to 32560
Data columns (total 5 columns):
 #   Column   Non-Null Count  Dtype
---  ------   --------------  -----
 0   income   32561 non-null  category
 1   sex      32561 non-null  category
 2   race     32561 non-null  category
 3   age      32561 non-null  int64
 4   hs_week  32561 non-null  int64
dtypes: category(3), int64(2)
memory usage: 604.7 KB
</pre></div></div>
</div>
<p>Instead of going straight to fitting models, we’re going to do a some exploratory analysis of the variables in the dataset. First we have some plots, and then some conclusions about the information in the plots.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Just a utilitary function to truncate labels and avoid overlapping in plots</span>
<span class="k">def</span> <span class="nf">truncate_labels</span><span class="p">(</span><span class="n">ticklabels</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">8</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">truncate</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">width</span> <span class="o">-</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">label</span><span class="p">[</span><span class="mi">0</span><span class="p">:(</span><span class="n">width</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)]</span> <span class="o">+</span> <span class="s1">&#39;...&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">label</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ticklabels</span><span class="p">]</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">truncate</span><span class="p">(</span><span class="n">lbl</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span> <span class="k">for</span> <span class="n">lbl</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">labels</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;income&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">saturation</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;sex&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">saturation</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;race&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">saturation</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">truncate_labels</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">);</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Age&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;hs_week&quot;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">);</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Hours of work / week&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_model_comparison_9_0.png" src="../_images/notebooks_model_comparison_9_0.png" />
</div>
</div>
<p><strong>Highlights</strong></p>
<ul class="simple">
<li><p>Approximately 25% of the people make more than 50K a year.</p></li>
<li><p>Two thirds of the subjects are males.</p></li>
<li><p>The great majority of the subjects are white, only a minority are black and the other categories are very infrequent.</p></li>
<li><p>The distribution of age is skewed to the right, as one might expect.</p></li>
<li><p>The distribution of hours of work per week looks weird at first sight. But what is a typical workload per week? You got it, 40 hours :).</p></li>
</ul>
<p>We only keep the races black and white to simplify the analysis. The other categories don’t appear very often in our data.</p>
<p>Now, we see the distribution of income for the different levels of our explanatory variables. Numerical variables are binned to make the analysis possible.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;race&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;Black&quot;</span><span class="p">,</span> <span class="s2">&quot;White&quot;</span><span class="p">])]</span>
<span class="n">data</span><span class="p">[</span><span class="s2">&quot;race&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;race&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">remove_unused_categories</span><span class="p">()</span>
<span class="n">age_bins</span> <span class="o">=</span> <span class="p">[</span><span class="mi">17</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">90</span><span class="p">]</span>
<span class="n">data</span><span class="p">[</span><span class="s2">&quot;age_binned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">],</span> <span class="n">age_bins</span><span class="p">)</span>
<span class="n">hours_bins</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
<span class="n">data</span><span class="p">[</span><span class="s2">&quot;hs_week_binned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;hs_week&quot;</span><span class="p">],</span> <span class="n">hours_bins</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;income&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;sex&quot;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;income&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]);</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;race&quot;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;income&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;age_binned&quot;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;income&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;hs_week_binned&quot;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;income&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_model_comparison_13_0.png" src="../_images/notebooks_model_comparison_13_0.png" />
</div>
</div>
<p>Some quick and gross info from the plots</p>
<ul class="simple">
<li><p>The probability of making more than \$50k a year is larger if you are a Male.</p></li>
<li><p>A person also has more probability of making more than \$50k/yr if she/he is White.</p></li>
<li><p>For age, we see the probability of making more than \$50k a year increases as the variable increases, up to a point where it starts to decrease.</p></li>
<li><p>Also, the more hours a person works per week, the higher the chance of making more than \$50k/yr. There’s a big jump in that probability when the hours of work per week jump from the (20, 40] bin to the (40, 60] one.</p></li>
</ul>
<p>Some data preparation before fitting our model. Here we standardize numerical variables <strong>age</strong> and <strong>hs_week</strong> because it may help sampler convergence. Also, we compute their second and third power. These powers will be sequantialy added to the model.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">age_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">])</span>
<span class="n">age_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">])</span>
<span class="n">hs_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;hs_week&quot;</span><span class="p">])</span>
<span class="n">hs_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;hs_week&quot;</span><span class="p">])</span>

<span class="n">data</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">age_mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">age_std</span>
<span class="n">data</span><span class="p">[</span><span class="s2">&quot;age2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">data</span><span class="p">[</span><span class="s2">&quot;age3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">3</span>
<span class="n">data</span><span class="p">[</span><span class="s2">&quot;hs_week&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;hs_week&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">hs_mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">hs_std</span>
<span class="n">data</span><span class="p">[</span><span class="s2">&quot;hs_week2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;hs_week&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">data</span><span class="p">[</span><span class="s2">&quot;hs_week3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;hs_week&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">3</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;age_binned&#39;</span><span class="p">,</span> <span class="s1">&#39;hs_week_binned&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>This is how our data looks like before fitting the models.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>income</th>
      <th>sex</th>
      <th>race</th>
      <th>age</th>
      <th>hs_week</th>
      <th>age2</th>
      <th>age3</th>
      <th>hs_week2</th>
      <th>hs_week3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>&lt;=50K</td>
      <td>Male</td>
      <td>White</td>
      <td>0.024207</td>
      <td>-0.037250</td>
      <td>0.000586</td>
      <td>0.000014</td>
      <td>0.001388</td>
      <td>-0.000052</td>
    </tr>
    <tr>
      <th>1</th>
      <td>&lt;=50K</td>
      <td>Male</td>
      <td>White</td>
      <td>0.827984</td>
      <td>-2.222326</td>
      <td>0.685557</td>
      <td>0.567630</td>
      <td>4.938734</td>
      <td>-10.975479</td>
    </tr>
    <tr>
      <th>2</th>
      <td>&lt;=50K</td>
      <td>Male</td>
      <td>White</td>
      <td>-0.048863</td>
      <td>-0.037250</td>
      <td>0.002388</td>
      <td>-0.000117</td>
      <td>0.001388</td>
      <td>-0.000052</td>
    </tr>
    <tr>
      <th>3</th>
      <td>&lt;=50K</td>
      <td>Male</td>
      <td>Black</td>
      <td>1.047195</td>
      <td>-0.037250</td>
      <td>1.096618</td>
      <td>1.148374</td>
      <td>0.001388</td>
      <td>-0.000052</td>
    </tr>
    <tr>
      <th>4</th>
      <td>&lt;=50K</td>
      <td>Female</td>
      <td>Black</td>
      <td>-0.779569</td>
      <td>-0.037250</td>
      <td>0.607728</td>
      <td>-0.473766</td>
      <td>0.001388</td>
      <td>-0.000052</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="The-model">
<h2>The model<a class="headerlink" href="#The-model" title="Permalink to this headline">¶</a></h2>
<p>We will use a logistic regression model to estimate the probability of making more than \$50K as a function of age, hours of work per week, sex, race and education level.</p>
<p>If we have a binary response variable <span class="math notranslate nohighlight">\(Y\)</span> and a set of predictors or explanatory variables <span class="math notranslate nohighlight">\(X_1, X_2, \cdots, X_p\)</span> the logistic regression model can be defined as follows:</p>
<div class="math notranslate nohighlight">
\[\log{\left(\frac{\pi}{1 - \pi}\right)} = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \cdots + \beta_p X_p\]</div>
<p>where <span class="math notranslate nohighlight">\(\pi = P(Y = 1)\)</span> (a.k.a. probability of success) and <span class="math notranslate nohighlight">\(\beta_0, \beta_1, \cdots \beta_p\)</span> are unknown parameters. The term on the left side is the logarithm of the odds ratio or simply known as the log-odds. With little effort, the expression can be re-arranged to express our probability of interest, <span class="math notranslate nohighlight">\(\pi\)</span>, as a function of the betas and the predictors.</p>
<div class="math notranslate nohighlight">
\[\pi = \frac{e^{\beta_0 + \beta_1 X_1 + \cdots + \beta_p X_p}}{1 + e^{\beta_0 + \beta_1 X_1 + \cdots + \beta_p X_p}}
    = \frac{1}{1 + e^{-(\beta_0 + \beta_1 X_1 + \cdots + \beta_p X_p)}}\]</div>
<p>We need to specify a prior and a likelihood in order to draw samples from the posterior distribution. We could use sociological knowledge about the effects of age and education on income, but instead, let’s use the default prior specification in Bambi.</p>
<p>The likelihood is the product of <span class="math notranslate nohighlight">\(n\)</span> Bernoulli trials, <span class="math notranslate nohighlight">\(\prod_{i=1}^{n}{p_i^y(1-p_i)^{1-y_i}}\)</span> where <span class="math notranslate nohighlight">\(p_i = P(Y=1)\)</span>.</p>
<p>In our case, we have</p>
<div class="math notranslate nohighlight">
\[\begin{split}Y =
\left\{
    \begin{array}{ll}
        1 &amp; \textrm{if the person makes more than 50K per year} \\
        0 &amp; \textrm{if the person makes less than 50K per year}
    \end{array}
\right.\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\pi = P(Y=1)\]</div>
<p>But this is a Bambi example, right? Let’s see how Bambi can helps us to build a logistic regression model.</p>
</div>
<div class="section" id="Model-1:">
<h2>Model 1:<a class="headerlink" href="#Model-1:" title="Permalink to this headline">¶</a></h2>
<div class="math notranslate nohighlight">
\[\log{\left(\frac{\pi}{1 - \pi}\right)} = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \beta_3 X_3 + \beta_4 X_4\]</div>
<p>Where:</p>
<p>$ X_1 = <span class="math">\displaystyle `:nbsphinx-math:</span>frac{text{Age} - text{Age}_{text{mean}}}{text{Age}_{text{std}}}` \ X_2 = <span class="math">\displaystyle `:nbsphinx-math:</span>frac{text{Hours_week} - text{Hours_week}_{text{mean}}}{text{Hours_week}_{text{std}}}` \ X_3 = :nbsphinx-math:<a href="#id1"><span class="problematic" id="id2">`</span></a>left`{</p>
<p><span class="math">\right</span>. \ X_4 = :nbsphinx-math:<a href="#id3"><span class="problematic" id="id4">`</span></a>left`{</p>
<p><span class="math">\right</span>. \ $</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">model1</span> <span class="o">=</span> <span class="n">bmb</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">fitted1</span> <span class="o">=</span> <span class="n">model1</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="s1">&#39;income[&gt;50K] ~ sex + race + age + hs_week&#39;</span><span class="p">,</span>
                     <span class="n">family</span><span class="o">=</span><span class="s1">&#39;bernoulli&#39;</span><span class="p">,</span> <span class="n">draws</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Modeling the probability that income==&gt;50K
Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (2 chains in 2 jobs)
NUTS: [hs_week, age, race, sex, Intercept]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
    <style>
        /* Turns off some styling */
        progress {
            /* gets rid of default border in Firefox and Opera. */
            border: none;
            /* Needs to be in here for Safari polyfill so background images work as expected. */
            background-size: auto;
        }
        .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
            background: #F44336;
        }
    </style>
  <progress value='4000' class='' max='4000' style='width:300px; height:20px; vertical-align: middle;'></progress>
  100.00% [4000/4000 01:12<00:00 Sampling 2 chains, 0 divergences]
</div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Sampling 2 chains for 1_000 tune and 1_000 draw iterations (2_000 + 2_000 draws total) took 73 seconds.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">az</span><span class="o">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="n">fitted1</span><span class="p">);</span>
<span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">fitted1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>sd</th>
      <th>hdi_3%</th>
      <th>hdi_97%</th>
      <th>mcse_mean</th>
      <th>mcse_sd</th>
      <th>ess_mean</th>
      <th>ess_sd</th>
      <th>ess_bulk</th>
      <th>ess_tail</th>
      <th>r_hat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Intercept</th>
      <td>-2.635</td>
      <td>0.062</td>
      <td>-2.741</td>
      <td>-2.514</td>
      <td>0.002</td>
      <td>0.001</td>
      <td>1276.0</td>
      <td>1272.0</td>
      <td>1271.0</td>
      <td>1189.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>sex</th>
      <td>1.017</td>
      <td>0.037</td>
      <td>0.943</td>
      <td>1.084</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>1689.0</td>
      <td>1689.0</td>
      <td>1673.0</td>
      <td>1282.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>race</th>
      <td>0.632</td>
      <td>0.058</td>
      <td>0.519</td>
      <td>0.736</td>
      <td>0.002</td>
      <td>0.001</td>
      <td>1333.0</td>
      <td>1297.0</td>
      <td>1338.0</td>
      <td>1013.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>age</th>
      <td>0.578</td>
      <td>0.015</td>
      <td>0.552</td>
      <td>0.607</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>1792.0</td>
      <td>1792.0</td>
      <td>1789.0</td>
      <td>1426.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>hs_week</th>
      <td>0.504</td>
      <td>0.015</td>
      <td>0.475</td>
      <td>0.533</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>2082.0</td>
      <td>2082.0</td>
      <td>2080.0</td>
      <td>1244.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_model_comparison_22_1.png" src="../_images/notebooks_model_comparison_22_1.png" />
</div>
</div>
</div>
<div class="section" id="Model-2">
<h2>Model 2<a class="headerlink" href="#Model-2" title="Permalink to this headline">¶</a></h2>
<div class="math notranslate nohighlight">
\[\log{\left(\frac{\pi}{1 - \pi}\right)} = \beta_0 + \beta_1 X_1 + \beta_2 X_1^2 + \beta_3 X_2 + \beta_4 X_2^2
                                         + \beta_5 X_3 + \beta_6 X_4\]</div>
<p>Where:</p>
<p>$ X_1 = <span class="math">\displaystyle `:nbsphinx-math:</span>frac{text{Age} - text{Age}_{text{mean}}}{text{Age}_{text{std}}}` \ X_2 = <span class="math">\displaystyle `:nbsphinx-math:</span>frac{text{Hours_week} - text{Hours_week}_{text{mean}}}{text{Hours_week}_{text{std}}}` \ X_3 = :nbsphinx-math:<a href="#id5"><span class="problematic" id="id6">`</span></a>left`{</p>
<p><span class="math">\right</span>. \ X_4 = :nbsphinx-math:<a href="#id7"><span class="problematic" id="id8">`</span></a>left`{</p>
<p><span class="math">\right</span>. $</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">model2</span> <span class="o">=</span> <span class="n">bmb</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">fitted2</span> <span class="o">=</span> <span class="n">model2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="s1">&#39;income[&gt;50K] ~ sex + race + age + age2 + hs_week + hs_week2&#39;</span><span class="p">,</span>
                     <span class="n">family</span><span class="o">=</span><span class="s1">&#39;bernoulli&#39;</span><span class="p">,</span> <span class="n">draws</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Modeling the probability that income==&gt;50K
Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (2 chains in 2 jobs)
NUTS: [hs_week2, hs_week, age2, age, race, sex, Intercept]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
    <style>
        /* Turns off some styling */
        progress {
            /* gets rid of default border in Firefox and Opera. */
            border: none;
            /* Needs to be in here for Safari polyfill so background images work as expected. */
            background-size: auto;
        }
        .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
            background: #F44336;
        }
    </style>
  <progress value='4000' class='' max='4000' style='width:300px; height:20px; vertical-align: middle;'></progress>
  100.00% [4000/4000 01:24<00:00 Sampling 2 chains, 0 divergences]
</div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Sampling 2 chains for 1_000 tune and 1_000 draw iterations (2_000 + 2_000 draws total) took 85 seconds.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">az</span><span class="o">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="n">fitted2</span><span class="p">);</span>
<span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">fitted2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>sd</th>
      <th>hdi_3%</th>
      <th>hdi_97%</th>
      <th>mcse_mean</th>
      <th>mcse_sd</th>
      <th>ess_mean</th>
      <th>ess_sd</th>
      <th>ess_bulk</th>
      <th>ess_tail</th>
      <th>r_hat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Intercept</th>
      <td>-2.285</td>
      <td>0.065</td>
      <td>-2.401</td>
      <td>-2.165</td>
      <td>0.002</td>
      <td>0.001</td>
      <td>1247.0</td>
      <td>1244.0</td>
      <td>1255.0</td>
      <td>1144.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>sex</th>
      <td>1.005</td>
      <td>0.037</td>
      <td>0.932</td>
      <td>1.070</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>1579.0</td>
      <td>1579.0</td>
      <td>1592.0</td>
      <td>1307.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>race</th>
      <td>0.705</td>
      <td>0.061</td>
      <td>0.595</td>
      <td>0.819</td>
      <td>0.002</td>
      <td>0.001</td>
      <td>1375.0</td>
      <td>1362.0</td>
      <td>1366.0</td>
      <td>1363.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>age</th>
      <td>1.069</td>
      <td>0.024</td>
      <td>1.025</td>
      <td>1.116</td>
      <td>0.001</td>
      <td>0.000</td>
      <td>1397.0</td>
      <td>1397.0</td>
      <td>1402.0</td>
      <td>1512.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>age2</th>
      <td>-0.538</td>
      <td>0.018</td>
      <td>-0.572</td>
      <td>-0.502</td>
      <td>0.001</td>
      <td>0.000</td>
      <td>1255.0</td>
      <td>1254.0</td>
      <td>1254.0</td>
      <td>1374.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>hs_week</th>
      <td>0.499</td>
      <td>0.022</td>
      <td>0.459</td>
      <td>0.540</td>
      <td>0.001</td>
      <td>0.000</td>
      <td>1624.0</td>
      <td>1624.0</td>
      <td>1617.0</td>
      <td>1432.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>hs_week2</th>
      <td>-0.088</td>
      <td>0.008</td>
      <td>-0.103</td>
      <td>-0.071</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>1644.0</td>
      <td>1640.0</td>
      <td>1626.0</td>
      <td>1521.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_model_comparison_25_1.png" src="../_images/notebooks_model_comparison_25_1.png" />
</div>
</div>
</div>
<div class="section" id="Model-3">
<h2>Model 3<a class="headerlink" href="#Model-3" title="Permalink to this headline">¶</a></h2>
<div class="math notranslate nohighlight">
\[\log{\left(\frac{\pi}{1 - \pi}\right)} = \beta_0 + \beta_1 X_1 + \beta_2 X_1^2 + \beta_3 X_1^3 + \beta_4 X_2
                                         + \beta_5 X_2^2 + \beta_6 X_2^3 + \beta_7 X_3 + \beta_8 X_4\]</div>
<p>Where:</p>
<p>$ X_1 = <span class="math">\displaystyle `:nbsphinx-math:</span>frac{text{Age} - text{Age}_{text{mean}}}{text{Age}_{text{std}}}` \ X_2 = <span class="math">\displaystyle `:nbsphinx-math:</span>frac{text{Hours_week} - text{Hours_week}_{text{mean}}}{text{Hours_week}_{text{std}}}` \ X_3 = :nbsphinx-math:<a href="#id9"><span class="problematic" id="id10">`</span></a>left`{</p>
<p><span class="math">\right</span>. \ X_4 = :nbsphinx-math:<a href="#id11"><span class="problematic" id="id12">`</span></a>left`{</p>
<p><span class="math">\right</span>. $</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">model3</span> <span class="o">=</span> <span class="n">bmb</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">fitted3</span> <span class="o">=</span> <span class="n">model3</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="s1">&#39;income[&gt;50K] ~ age + age2 + age3 + hs_week + hs_week2 + hs_week3 + sex + race&#39;</span><span class="p">,</span>
                     <span class="n">family</span><span class="o">=</span><span class="s1">&#39;bernoulli&#39;</span><span class="p">,</span> <span class="n">draws</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Modeling the probability that income==&gt;50K
Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (2 chains in 2 jobs)
NUTS: [hs_week3, hs_week2, hs_week, age3, age2, age, race, sex, Intercept]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
    <style>
        /* Turns off some styling */
        progress {
            /* gets rid of default border in Firefox and Opera. */
            border: none;
            /* Needs to be in here for Safari polyfill so background images work as expected. */
            background-size: auto;
        }
        .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
            background: #F44336;
        }
    </style>
  <progress value='4000' class='' max='4000' style='width:300px; height:20px; vertical-align: middle;'></progress>
  100.00% [4000/4000 01:45<00:00 Sampling 2 chains, 0 divergences]
</div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Sampling 2 chains for 1_000 tune and 1_000 draw iterations (2_000 + 2_000 draws total) took 106 seconds.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">az</span><span class="o">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="n">fitted3</span><span class="p">);</span>
<span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">fitted3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>sd</th>
      <th>hdi_3%</th>
      <th>hdi_97%</th>
      <th>mcse_mean</th>
      <th>mcse_sd</th>
      <th>ess_mean</th>
      <th>ess_sd</th>
      <th>ess_bulk</th>
      <th>ess_tail</th>
      <th>r_hat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Intercept</th>
      <td>-2.144</td>
      <td>0.064</td>
      <td>-2.268</td>
      <td>-2.024</td>
      <td>0.002</td>
      <td>0.001</td>
      <td>1339.0</td>
      <td>1339.0</td>
      <td>1344.0</td>
      <td>1437.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>sex</th>
      <td>0.986</td>
      <td>0.036</td>
      <td>0.920</td>
      <td>1.053</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>2166.0</td>
      <td>2147.0</td>
      <td>2165.0</td>
      <td>1382.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>race</th>
      <td>0.679</td>
      <td>0.060</td>
      <td>0.558</td>
      <td>0.784</td>
      <td>0.002</td>
      <td>0.001</td>
      <td>1456.0</td>
      <td>1456.0</td>
      <td>1452.0</td>
      <td>1243.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>age</th>
      <td>0.964</td>
      <td>0.026</td>
      <td>0.914</td>
      <td>1.011</td>
      <td>0.001</td>
      <td>0.000</td>
      <td>2620.0</td>
      <td>2620.0</td>
      <td>2635.0</td>
      <td>1343.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>age2</th>
      <td>-0.895</td>
      <td>0.030</td>
      <td>-0.956</td>
      <td>-0.841</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>1273.0</td>
      <td>1273.0</td>
      <td>1275.0</td>
      <td>1257.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>age3</th>
      <td>0.175</td>
      <td>0.011</td>
      <td>0.153</td>
      <td>0.194</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>1523.0</td>
      <td>1523.0</td>
      <td>1522.0</td>
      <td>1433.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>hs_week</th>
      <td>0.612</td>
      <td>0.024</td>
      <td>0.566</td>
      <td>0.658</td>
      <td>0.001</td>
      <td>0.000</td>
      <td>1793.0</td>
      <td>1793.0</td>
      <td>1787.0</td>
      <td>1405.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>hs_week2</th>
      <td>-0.010</td>
      <td>0.010</td>
      <td>-0.031</td>
      <td>0.007</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>1678.0</td>
      <td>1355.0</td>
      <td>1696.0</td>
      <td>1426.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>hs_week3</th>
      <td>-0.035</td>
      <td>0.003</td>
      <td>-0.041</td>
      <td>-0.028</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>1382.0</td>
      <td>1382.0</td>
      <td>1393.0</td>
      <td>1331.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_model_comparison_28_1.png" src="../_images/notebooks_model_comparison_28_1.png" />
</div>
</div>
</div>
<div class="section" id="Model-comparison">
<h2>Model comparison<a class="headerlink" href="#Model-comparison" title="Permalink to this headline">¶</a></h2>
<p>We can perform a Bayesian model comparison very easily with <code class="docutils literal notranslate"><span class="pre">az.compare()</span></code>. Here we pass a dictionary with the InferenceData objects that <code class="docutils literal notranslate"><span class="pre">Model.fit()</span></code> returned and <code class="docutils literal notranslate"><span class="pre">az.compare()</span></code> returns a data frame that is ordered from best to worst according to the criteria used. By default, ArviZ uses <em>loo</em>, which is an estimation of leave one out cross validation. Another option is the widely applicable information criterion (WAIC). For more information about the information criterias available and
other options within the function <a class="reference external" href="https://arviz-devs.github.io/arviz/api/generated/arviz.compare.html">see the docs</a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">models_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;model1&quot;</span><span class="p">:</span> <span class="n">fitted1</span><span class="p">,</span>
    <span class="s2">&quot;model2&quot;</span><span class="p">:</span> <span class="n">fitted2</span><span class="p">,</span>
    <span class="s2">&quot;model3&quot;</span><span class="p">:</span> <span class="n">fitted3</span>
<span class="p">}</span>
<span class="n">df_compare</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">models_dict</span><span class="p">)</span>
<span class="n">df_compare</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/tomas/anaconda3/envs/bmb/lib/python3.8/site-packages/arviz/stats/stats.py:144: UserWarning: The default method used to estimate the weights for each model,has changed from BB-pseudo-BMA to stacking
  warnings.warn(
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rank</th>
      <th>loo</th>
      <th>p_loo</th>
      <th>d_loo</th>
      <th>weight</th>
      <th>se</th>
      <th>dse</th>
      <th>warning</th>
      <th>loo_scale</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>model3</th>
      <td>0</td>
      <td>-13986.8</td>
      <td>9.31418</td>
      <td>0</td>
      <td>1</td>
      <td>89.3039</td>
      <td>0</td>
      <td>False</td>
      <td>log</td>
    </tr>
    <tr>
      <th>model2</th>
      <td>1</td>
      <td>-14155</td>
      <td>8.03055</td>
      <td>168.148</td>
      <td>2.3648e-08</td>
      <td>91.3281</td>
      <td>19.855</td>
      <td>False</td>
      <td>log</td>
    </tr>
    <tr>
      <th>model1</th>
      <td>2</td>
      <td>-14915.9</td>
      <td>4.88729</td>
      <td>929.021</td>
      <td>0</td>
      <td>90.9626</td>
      <td>38.9311</td>
      <td>False</td>
      <td>log</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">az</span><span class="o">.</span><span class="n">plot_compare</span><span class="p">(</span><span class="n">df_compare</span><span class="p">,</span> <span class="n">insample_dev</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_model_comparison_31_0.png" src="../_images/notebooks_model_comparison_31_0.png" />
</div>
</div>
<p>There is a difference in the point estimations (empty circles) between the model with cubic terms (model 3) and the model with quadratic terms (model 2) but there is some overlap between their interval estimations. This time, we are going to select model 2 and do some extra little work with it because from previous experience with this dataset we know there is no substantial difference between them, and model 2 is simpler. However, as we mention in the final remarks, this is not the best you can
achieve with this dataset. If you want, you could also try to add other predictors, such as education level and see how it impacts in the model comparison :).</p>
</div>
<div class="section" id="Probability-estimation">
<h2>Probability estimation<a class="headerlink" href="#Probability-estimation" title="Permalink to this headline">¶</a></h2>
<p>In this section we plot age vs the probability of making more than 50K a year given different profiles.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">posterior</span> <span class="o">=</span> <span class="n">fitted2</span><span class="o">.</span><span class="n">posterior</span><span class="o">.</span><span class="n">stack</span><span class="p">({</span><span class="s2">&quot;draws&quot;</span><span class="p">:[</span><span class="s2">&quot;chain&quot;</span><span class="p">,</span> <span class="s2">&quot;draw&quot;</span><span class="p">]})</span>
</pre></div>
</div>
</div>
<p>We set hours of work per week at 40 hours and assign a grid from 18 to 75 age. They’re standardized because they were standardized when we fitted the model.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">HS_WEEK</span> <span class="o">=</span> <span class="p">(</span><span class="mi">40</span> <span class="o">-</span> <span class="n">hs_mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">hs_std</span>
<span class="n">AGE</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span> <span class="o">-</span> <span class="n">age_mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">age_std</span>
<span class="n">AGE</span> <span class="o">=</span> <span class="n">AGE</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>Now we compute the intercepts for the four combinations between sex and race.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">int_fem_black</span> <span class="o">=</span> <span class="n">posterior</span><span class="p">[</span><span class="s1">&#39;Intercept&#39;</span><span class="p">]</span>
<span class="n">int_mal_black</span> <span class="o">=</span> <span class="n">int_fem_black</span> <span class="o">+</span> <span class="n">posterior</span><span class="p">[</span><span class="s1">&#39;sex&#39;</span><span class="p">]</span>
<span class="n">int_fem_white</span> <span class="o">=</span> <span class="n">int_fem_black</span> <span class="o">+</span> <span class="n">posterior</span><span class="p">[</span><span class="s1">&#39;race&#39;</span><span class="p">]</span>
<span class="n">int_mal_white</span> <span class="o">=</span> <span class="n">int_mal_black</span> <span class="o">+</span> <span class="n">posterior</span><span class="p">[</span><span class="s1">&#39;race&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>The contribution of hours of work per week.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hs_contr</span> <span class="o">=</span> <span class="n">HS_WEEK</span> <span class="o">*</span> <span class="n">posterior</span><span class="p">[</span><span class="s1">&#39;hs_week&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="kc">None</span><span class="p">,:]</span>
<span class="n">hs_contr</span> <span class="o">+=</span> <span class="n">HS_WEEK</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">posterior</span><span class="p">[</span><span class="s1">&#39;hs_week2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="kc">None</span><span class="p">,:]</span>
</pre></div>
</div>
</div>
<p>And the linear predictor for all the ages in the grid.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">age_contr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">AGE</span><span class="p">,</span> <span class="n">posterior</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="kc">None</span><span class="p">,:])</span>
<span class="n">age_contr</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">AGE</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">posterior</span><span class="p">[</span><span class="s1">&#39;age2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="kc">None</span><span class="p">,:])</span>
</pre></div>
</div>
</div>
<p>Then we just store all the linear predictors in a list called <code class="docutils literal notranslate"><span class="pre">eta</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">eta_base</span> <span class="o">=</span> <span class="n">hs_contr</span> <span class="o">+</span> <span class="n">age_contr</span>
<span class="n">eta_fem_black</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">int_fem_black</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">eta_base</span>
<span class="n">eta_mal_black</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">int_mal_black</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">eta_base</span>
<span class="n">eta_fem_white</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">int_fem_white</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">eta_base</span>
<span class="n">eta_mal_white</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">int_mal_white</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">eta_base</span>

<span class="n">etas</span> <span class="o">=</span> <span class="p">[</span><span class="n">eta_fem_black</span><span class="p">,</span> <span class="n">eta_mal_black</span><span class="p">,</span> <span class="n">eta_fem_white</span><span class="p">,</span> <span class="n">eta_mal_white</span><span class="p">]</span>
<span class="n">age</span> <span class="o">=</span> <span class="n">AGE</span> <span class="o">*</span> <span class="n">age_std</span> <span class="o">+</span> <span class="n">age_mean</span>
</pre></div>
</div>
</div>
<p>And finally, the plot :)</p>
<p>Here we use <code class="docutils literal notranslate"><span class="pre">az.plot_hdi()</span></code> to get Highest Density Interval plots. We get two bands for each profile. One corresponds to an hdi probability of 0.94 (the default) and the other to an hdi probability of 0.5.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;C</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Black - Female&quot;</span><span class="p">,</span> <span class="s2">&quot;Black - Male&quot;</span><span class="p">,</span> <span class="s2">&quot;White - Female&quot;</span><span class="p">,</span> <span class="s2">&quot;White - Male&quot;</span><span class="p">]</span>
<span class="n">handles</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="k">for</span> <span class="n">eta</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">etas</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
    <span class="n">az</span><span class="o">.</span><span class="n">plot_hdi</span><span class="p">(</span><span class="n">age</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">invlogit</span><span class="p">(</span><span class="n">eta</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
    <span class="n">az</span><span class="o">.</span><span class="n">plot_hdi</span><span class="p">(</span><span class="n">age</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">invlogit</span><span class="p">(</span><span class="n">eta</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">hdi_prob</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">handles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mlines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Age&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;P(Income &gt; $50K)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">handles</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_model_comparison_46_0.png" src="../_images/notebooks_model_comparison_46_0.png" />
</div>
</div>
<p>The highest posterior density bands show how the probability of earning more than 50K changes with age for a given profile. In all the cases, we see the probability of making more than $50K increases with age until approximately age 52, when the probability begins to drop off. We can interpret narrow portions of a curve as places where we have low uncertainty and spread out portions of the bands as places where we have somewhat higher uncertainty about our coefficient values.</p>
<div class="section" id="Final-remarks">
<h3>Final remarks<a class="headerlink" href="#Final-remarks" title="Permalink to this headline">¶</a></h3>
<p>In this notebook we’ve seen how easy it is to incorporate ArviZ into a Bambi workflow to perform model comparison based on information criterias such as <strong>LOO</strong> and <strong>WAIC</strong>. However, an attentive reader might have seen that the highest density interval plot never shows a predicted probability greater than 0.5 (which is not good if we expect to predict that at least some people working 40hrs/wk make more than \$50k/yr). You can increase the hours of work per week for the profiles we’ve used and
the HDIs will show larger values. But we won’t be seeing the whole picture.</p>
<p>Although we’re using some demographic variables such as <strong>sex</strong> and <strong>race</strong>, the cells resulting from the combinations of their levels are still very heterogeneous. For example, we are mixing individuals of all educational levels. A possible next step is to <strong>incorporate education</strong> into the different models we compared. If any of the readers (yes, you!) is interested in doing so, here there are some notes that may help</p>
<ul class="simple">
<li><p>Education is an ordinal categorical variable with a lot of levels.</p>
<ul>
<li><p>Explore the conditional distribution of income given education levels.</p></li>
<li><p>See what are the counts/proportions of people within each education level.</p></li>
<li><p>Collapse categories (but respect the ordinality!). Try to end up with 5 or less categories if possible.</p></li>
</ul>
</li>
<li><p>Start with a model with only <strong>age</strong>, <strong>sex</strong>, <strong>race</strong>, <strong>hs_week</strong> and <strong>education</strong>. Then incorporate higher order terms (second and third powers for example). Don’t go beyond fourth powers.</p></li>
<li><p>Look for a nice activity to do while the sampler does its job.
We know it’s going to take a couple of hours to fit all those models :)</p></li>
</ul>
<p>And finally, please feel free to <a class="reference external" href="https://github.com/bambinos/bambi/issues">open a new issue</a> if you think there’s something that we can improve.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">load_ext</span> watermark
<span class="o">%</span><span class="k">watermark</span> -n -u -v -iv -w
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
pandas  1.1.5
numpy   1.19.4
bambi   0.2.0
arviz   0.10.0
seaborn 0.11.0
last updated: Tue Dec 15 2020

CPython 3.8.5
IPython 7.18.1
watermark 2.0.2
</pre></div></div>
</div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">bambi</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=bambinos&repo=bambi&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="logistic_regression.html">Logistic Regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="multi-level_regression.html">Multi-level Regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="t-test.html">T-test</a></li>
<li class="toctree-l2"><a class="reference internal" href="ESCS_multiple_regression.html">Multiple Regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="shooter_crossed_random_ANOVA.html">Bayesian Workflow (Police Officer’s Dilemma)</a></li>
<li class="toctree-l2"><a class="reference internal" href="Strack_RRR_re_analysis.html">Bayesian Workflow (Strack RRR Analysis Replication)</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Logistic Regression and Model Comparison with Bambi and Arviz</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Adults-dataset">Adults dataset</a></li>
<li class="toctree-l3"><a class="reference internal" href="#The-model">The model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Model-1:">Model 1:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Model-2">Model 2</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Model-3">Model 3</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Model-comparison">Model comparison</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Probability-estimation">Probability estimation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Final-remarks">Final remarks</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference.html">API Reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../examples.html">Examples</a><ul>
      <li>Previous: <a href="Strack_RRR_re_analysis.html" title="previous chapter">Bayesian Workflow (Strack RRR Analysis Replication)</a></li>
      <li>Next: <a href="../api_reference.html" title="next chapter">API Reference</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, The developers of Bambi.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.2.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/notebooks/model_comparison.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/bambinos/bambi" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>